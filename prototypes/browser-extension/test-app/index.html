<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SDK Test App</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            padding: 20px;
            background: #f8fafc;
        }

        h1 {
            font-size: 1.25rem;
            color: #1e293b;
            margin-bottom: 16px;
        }

        .btn-group {
            margin-bottom: 8px;
        }

        .btn {
            padding: 10px 16px;
            margin: 4px;
            border: none;
            background: #8b5cf6;
            color: white;
            border-radius: 8px;
            font-size: 0.85rem;
            cursor: pointer;
        }

        .btn:hover {
            background: #7c3aed;
        }

        .result {
            margin-top: 16px;
            padding: 16px;
            background: white;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
            white-space: pre-wrap;
            font-size: 0.85rem;
            max-height: 300px;
            overflow-y: auto;
        }

        .status {
            color: #64748b;
            font-size: 0.85rem;
            margin-bottom: 12px;
        }

        .connected {
            color: #10b981;
        }

        .error {
            color: #ef4444;
        }

        .screenshot {
            max-width: 100%;
            margin-top: 12px;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
        }
    </style>
</head>

<body>
    <h1>üß™ GemiGo SDK Test</h1>
    <div class="status" id="status">Connecting...</div>

    <div class="btn-group">
        <button class="btn" onclick="testGetPageInfo()">Page Info</button>
        <button class="btn" onclick="testGetPageHTML()">Page HTML</button>
        <button class="btn" onclick="testGetSelection()">Selection</button>
    </div>
    <div class="btn-group">
        <button class="btn" onclick="testHighlight()">Highlight</button>
        <button class="btn" onclick="testNotify()">Notify</button>
        <button class="btn" onclick="testCapture()">Screenshot</button>
        <button class="btn" onclick="testExtract()">Extract Article</button>
    </div>

    <div class="result" id="result">Click a button to test SDK API...</div>
    <img id="screenshot" class="screenshot" style="display:none" />

    <script src="https://unpkg.com/penpal@6.2.2/dist/penpal.min.js"></script>
    <script>
        let gemigo = null;

        const connection = Penpal.connectToParent({
            methods: {}
        });

        connection.promise.then((parent) => {
            gemigo = parent;
            document.getElementById('status').textContent = '‚úÖ Connected to GemiGo';
            document.getElementById('status').className = 'status connected';
        }).catch((err) => {
            document.getElementById('status').textContent = '‚ùå Connection failed: ' + err.message;
            document.getElementById('status').className = 'status error';
        });

        function showResult(title, data) {
            document.getElementById('result').textContent =
                `[${title}]\n` + JSON.stringify(data, null, 2);
            document.getElementById('screenshot').style.display = 'none';
        }

        async function testGetPageInfo() {
            if (!gemigo) return showResult('Error', 'Not connected');
            const result = await gemigo.getPageInfo();
            showResult('getPageInfo()', result);
        }

        async function testGetPageHTML() {
            if (!gemigo) return showResult('Error', 'Not connected');
            const result = await gemigo.getPageHTML();
            showResult('getPageHTML()', { length: result.length, preview: result.slice(0, 500) });
        }

        async function testGetSelection() {
            if (!gemigo) return showResult('Error', 'Not connected');
            const result = await gemigo.getSelection();
            showResult('getSelection()', { selection: result });
        }

        async function testHighlight() {
            if (!gemigo) return showResult('Error', 'Not connected');
            const result = await gemigo.highlight('h1, h2, h3');
            showResult('highlight()', result);
        }

        async function testNotify() {
            if (!gemigo) return showResult('Error', 'Not connected');
            const result = await gemigo.notify({
                title: 'GemiGo Notification',
                message: 'This is a test notification!'
            });
            showResult('notify()', result);
        }

        async function testCapture() {
            if (!gemigo) return showResult('Error', 'Not connected');
            const result = await gemigo.captureVisible();
            if (result.success && result.dataUrl) {
                showResult('captureVisible()', { success: true, size: result.dataUrl.length });
                const img = document.getElementById('screenshot');
                img.src = result.dataUrl;
                img.style.display = 'block';
            } else {
                showResult('captureVisible()', result);
            }
        }

        async function testExtract() {
            if (!gemigo) return showResult('Error', 'Not connected');
            const result = await gemigo.extractArticle();
            showResult('extractArticle()', {
                success: result.success,
                title: result.title,
                excerpt: result.excerpt,
                contentLength: result.content?.length
            });
        }
    </script>
</body>

</html>