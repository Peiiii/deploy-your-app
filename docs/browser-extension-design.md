# GemiGo Browser Extension Platform - Feature Design

## Vision
ä¸€ä¸ªè¿è¡Œåœ¨æµè§ˆå™¨ä¾§è¾¹æ ä¸­çš„åº”ç”¨å¹³å°ï¼Œç”¨æˆ·å¯ä»¥å°†å¹³å°ä¸Šéƒ¨ç½²çš„ä»»æ„åº”ç”¨"å®‰è£…"åˆ°è¿™ä¸ªç¯å¢ƒä¸­ï¼Œè¿™äº›åº”ç”¨è‡ªåŠ¨è·å¾—ä¸æµè§ˆå™¨äº¤äº’çš„èƒ½åŠ›ã€‚

---

## ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Chrome Browser                                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                         â”‚        GemiGo Side Panel         â”‚
â”‚                                         â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚                                         â”‚  â”‚ ğŸ  é¦–é¡µ  ğŸ“¦ åº”ç”¨  âš™ï¸ è®¾ç½®  â”‚  â”‚
â”‚          å½“å‰ç½‘é¡µå†…å®¹                    â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚                                         â”‚  â”‚                            â”‚  â”‚
â”‚     (App å¯é€šè¿‡ SDK è¯»å–/æ“ä½œ)          â”‚  â”‚   [ åµŒå…¥çš„ App å†…å®¹ ]       â”‚  â”‚
â”‚                                         â”‚  â”‚   (iframe åŠ è½½å·²éƒ¨ç½²åº”ç”¨)   â”‚  â”‚
â”‚                                         â”‚  â”‚                            â”‚  â”‚
â”‚                                         â”‚  â”‚                            â”‚  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚                                    â”‚
                      â”‚          postMessage               â”‚
                      â–¼                                    â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ Content Script â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ Extension Core  â”‚
              â”‚ (é¡µé¢æ³¨å…¥è„šæœ¬)  â”‚                   â”‚ (Service Worker)â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                          â–²
                                                          â”‚
                                                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”
                                                  â”‚   GemiGo SDK  â”‚
                                                  â”‚ (æ³¨å…¥åˆ° App)   â”‚
                                                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## æ ¸å¿ƒç»„ä»¶

### 1. Side Panel (ä¸»ç•Œé¢)
Chrome åŸç”Ÿä¾§è¾¹æ ï¼Œä½œä¸ºåº”ç”¨çš„è¿è¡Œå®¹å™¨ã€‚

| åŒºåŸŸ | åŠŸèƒ½ |
|------|------|
| **é¡¶éƒ¨å¯¼èˆª** | é¦–é¡µ / åº”ç”¨åˆ—è¡¨ / è®¾ç½® |
| **åº”ç”¨åŒºåŸŸ** | iframe åŠ è½½å½“å‰æ¿€æ´»çš„åº”ç”¨ |
| **åº•éƒ¨å·¥å…·æ ** | å¿«æ·æ“ä½œã€é€šçŸ¥ã€ç™»å½•çŠ¶æ€ |

### 2. App Runtime
ç®¡ç†åº”ç”¨çš„åŠ è½½ã€ç”Ÿå‘½å‘¨æœŸå’Œæƒé™ã€‚

```typescript
interface AppManifest {
  id: string;
  name: string;
  url: string;           // éƒ¨ç½²çš„åº”ç”¨ URL
  icon: string;
  permissions: Permission[];  // è¯·æ±‚çš„èƒ½åŠ›
}
```

> ğŸ“– **æƒé™å®šä¹‰**ï¼šè¯¦è§ [APP_SDK_API.md - åº”ç”¨æ¸…å•è§„èŒƒ](./tech/APP_SDK_API.md#åº”ç”¨æ¸…å•è§„èŒƒ-manifest)


### 3. SDK (`@gemigo/extension-sdk`)
æ³¨å…¥åˆ° App iframe ä¸­ï¼Œæä¾›ä¸æ‰©å±•é€šä¿¡çš„æ¡¥æ¢ã€‚

> ğŸ“– **API è¯¦ç»†æ–‡æ¡£**ï¼š[docs/tech/APP_SDK_API.md](./tech/APP_SDK_API.md) - ç¬¬ 3 èŠ‚ã€Œæµè§ˆå™¨æ‰©å±• APIã€
>
> æ ¸å¿ƒå‘½åç©ºé—´ï¼š`gemigo.extension.*`

**èƒ½åŠ›æ¦‚è§ˆ**ï¼š

| åˆ†ç±» | èƒ½åŠ› |
|------|------|
| é¡µé¢è¯»å– | `getPageInfo()`, `getPageHTML()`, `extractArticle()` ç­‰ |
| é¡µé¢ä¿®æ”¹ | `highlight()`, `insertWidget()`, `injectCSS()` |
| äº‹ä»¶ç›‘å¬ | `onSelectionChange()`, `onNavigate()`, `onScroll()` |
| æˆªå›¾ | `captureVisible()`, `captureFull()` |
| å¿«æ·é”® | `registerShortcut()` |
| èœå•äº¤äº’ | `onContextMenu()`, `onSelectionAction()` |

---

## é€šä¿¡æœºåˆ¶

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   postMessage   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   chrome.* API   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   App (iframe)â”‚ â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚  Side Panel  â”‚ â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚   Browser    â”‚
â”‚   + SDK       â”‚                â”‚  (Host)      â”‚                  â”‚   APIs       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â”‚
                                        â”‚ chrome.tabs.sendMessage
                                        â–¼
                                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                 â”‚Content Scriptâ”‚ â”€â”€â”€â–º å½“å‰é¡µé¢ DOM
                                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å®‰å…¨è¾¹ç•Œ**ï¼š
- App åœ¨ iframe æ²™ç®±ä¸­è¿è¡Œï¼Œæ— æ³•ç›´æ¥è®¿é—® chrome.* API
- æ‰€æœ‰èƒ½åŠ›è¯·æ±‚å¿…é¡»é€šè¿‡ SDK â†’ Host â†’ Service Worker è½¬å‘
- Host æ ¹æ® App Manifest ä¸­å£°æ˜çš„æƒé™è¿›è¡Œæ ¡éªŒ

---

## ç”¨æˆ·æµç¨‹

### å®‰è£…åº”ç”¨
1. ç”¨æˆ·åœ¨å¹³å°ä¸Šéƒ¨ç½²äº†ä¸€ä¸ªåº”ç”¨
2. åº”ç”¨è¯¦æƒ…é¡µæ˜¾ç¤º"æ·»åŠ åˆ°æµè§ˆå™¨æ‰©å±•"æŒ‰é’®
3. ç‚¹å‡»åï¼Œåº”ç”¨çš„ Manifest åŒæ­¥åˆ°æ‰©å±•çš„æœ¬åœ°å­˜å‚¨
4. ä¾§è¾¹æ åº”ç”¨åˆ—è¡¨ä¸­å‡ºç°æ–°åº”ç”¨

### ä½¿ç”¨åº”ç”¨
1. ç”¨æˆ·æ‰“å¼€ä¾§è¾¹æ 
2. ç‚¹å‡»åº”ç”¨å›¾æ ‡ â†’ iframe åŠ è½½åº”ç”¨ URL
3. åº”ç”¨å†…çš„ SDK è‡ªåŠ¨åˆå§‹åŒ–ï¼Œå»ºç«‹ä¸ Host çš„è¿æ¥
4. åº”ç”¨å¯ä»¥è¯»å–å½“å‰é¡µé¢å†…å®¹ã€æ³¨å†Œå³é”®èœå•ç­‰

---

## æƒé™æ¨¡å‹

| æƒé™ | é£é™©ç­‰çº§ | æˆæƒæ–¹å¼ |
|------|----------|----------|
| `storage` | ä½ | é»˜è®¤æˆäºˆ |
| `notifications` | ä½ | é»˜è®¤æˆäºˆ |
| `page:read` | ä¸­ | é¦–æ¬¡ä½¿ç”¨æ—¶æç¤º |
| `page:modify` | é«˜ | æ˜ç¡®ç”¨æˆ·ç¡®è®¤ |
| `tabs` | é«˜ | æ˜ç¡®ç”¨æˆ·ç¡®è®¤ |

---

## æŠ€æœ¯å®ç°

### ç›®å½•ç»“æ„
```
browser-extension/
â”œâ”€â”€ manifest.json
â”œâ”€â”€ sidepanel/           # Side Panel ä¸»ç•Œé¢
â”‚   â”œâ”€â”€ index.html
â”‚   â””â”€â”€ app.tsx          # React åº”ç”¨
â”œâ”€â”€ background/          # Service Worker
â”‚   â”œâ”€â”€ index.ts
â”‚   â”œâ”€â”€ app-runtime.ts   # App ç”Ÿå‘½å‘¨æœŸç®¡ç†
â”‚   â””â”€â”€ permission.ts    # æƒé™æ ¡éªŒ
â”œâ”€â”€ content-scripts/     # é¡µé¢æ³¨å…¥è„šæœ¬
â”‚   â””â”€â”€ bridge.ts        # é¡µé¢æ“ä½œæ¡¥æ¥
â”œâ”€â”€ sdk/                 # @gemigo/extension-sdk
â”‚   â””â”€â”€ index.ts         # æ³¨å…¥åˆ° App çš„ SDK
â””â”€â”€ shared/
    â””â”€â”€ types.ts
```

### æŠ€æœ¯æ ˆ
- **Manifest V3** (Chrome æ¨èæ ‡å‡†)
- **React + TypeScript** (ä¸ä¸»é¡¹ç›®ä¸€è‡´)
- **Vite** æ„å»º (ä½œä¸º monorepo çš„ä¸€éƒ¨åˆ†)

---

## åˆ†é˜¶æ®µé‡Œç¨‹ç¢‘

### Phase 1: åŸºç¡€æ¡†æ¶
- [ ] Side Panel åŸºç¡€ UI (åº”ç”¨åˆ—è¡¨ + å¯¼èˆª)
- [ ] App iframe åŠ è½½æœºåˆ¶
- [ ] SDK åŸºç¡€é€šä¿¡ ([penpal](https://github.com/Aaronius/penpal) + postMessage)
- [ ] ç”¨æˆ·ç™»å½•/åŒæ­¥åº”ç”¨åˆ—è¡¨

### Phase 2: é¡µé¢äº¤äº’
- [ ] `gemigo.extension.getPageInfo()` - é¡µé¢åŸºæœ¬ä¿¡æ¯
- [ ] `gemigo.extension.getPageHTML()` - é¡µé¢å†…å®¹è¯»å–
- [ ] `gemigo.extension.extractArticle()` - æ­£æ–‡æå–
- [ ] æƒé™è¯·æ±‚å¼¹çª—

### Phase 3: é«˜çº§èƒ½åŠ›
- [ ] `gemigo.extension.highlight()` - å…ƒç´ é«˜äº®
- [ ] `gemigo.extension.insertWidget()` - æµ®å±‚æ’å…¥
- [ ] `gemigo.extension.onContextMenu()` - å³é”®èœå•
- [ ] `gemigo.extension.captureVisible()` - æˆªå›¾
- [ ] `gemigo.extension.registerShortcut()` - å¿«æ·é”®

### Phase 4: ç”Ÿæ€
- [ ] åº”ç”¨å¸‚åœºå±•ç¤º (ä¾§è¾¹æ å†…)
- [ ] ä¸€é”®å®‰è£…æŒ‰é’® (ç½‘é¡µç«¯)
- [ ] å¼€å‘è€…æ–‡æ¡£ & SDK å‘å¸ƒ

---

## ç›¸å…³èµ„æº

- ğŸ“– [SDK API æ–‡æ¡£](./tech/APP_SDK_API.md)
- ğŸ¨ [äº¤äº’åŸå‹](../prototypes/browser-extension/index.html)
