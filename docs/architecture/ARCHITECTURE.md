# æ¶æ„æ–‡æ¡£

æœ¬æ–‡æ¡£ä»‹ç» GemiGo é¡¹ç›®çš„æ•´ä½“æ¶æ„å’ŒæŠ€æœ¯è®¾è®¡ã€‚

## ğŸ“‹ ç›®å½•

- [ç³»ç»Ÿæ¦‚è§ˆ](#ç³»ç»Ÿæ¦‚è§ˆ)
- [æ¶æ„åˆ†å±‚](#æ¶æ„åˆ†å±‚)
- [æŠ€æœ¯æ ˆ](#æŠ€æœ¯æ ˆ)
- [æ•°æ®æµ](#æ•°æ®æµ)
- [æ ¸å¿ƒæ¨¡å—](#æ ¸å¿ƒæ¨¡å—)
- [éƒ¨ç½²æ¶æ„](#éƒ¨ç½²æ¶æ„)

## ç³»ç»Ÿæ¦‚è§ˆ

GemiGo æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼çš„å‰ç«¯åº”ç”¨éƒ¨ç½²å¹³å°ï¼Œé‡‡ç”¨å¾®æœåŠ¡æ¶æ„ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   æµè§ˆå™¨å®¢æˆ·ç«¯    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ HTTPS
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Cloudflare Pages              â”‚
â”‚   (gemigo.io)                   â”‚
â”‚   - å‰ç«¯é™æ€èµ„æº                 â”‚
â”‚   - _worker.js (API ä»£ç†)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Cloudflare Workers            â”‚
â”‚   (gemigo-api)                  â”‚
â”‚   - ç”¨æˆ·è®¤è¯                     â”‚
â”‚   - é¡¹ç›® CRUD                    â”‚
â”‚   - éƒ¨ç½²è¯·æ±‚ä»£ç†                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â–¼                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Cloudflare D1  â”‚  â”‚ Node éƒ¨ç½²æœåŠ¡ â”‚
â”‚  æ•°æ®åº“          â”‚  â”‚ (Aliyun)    â”‚
â”‚  - ç”¨æˆ·æ•°æ®      â”‚  â”‚ - æ„å»ºæ‰§è¡Œ    â”‚
â”‚  - é¡¹ç›®æ•°æ®      â”‚  â”‚ - éƒ¨ç½²åˆ° R2  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ Cloudflare R2 â”‚
                    â”‚ å­˜å‚¨æ„å»ºäº§ç‰©   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## æ¶æ„åˆ†å±‚

### 1. å‰ç«¯å±‚ (Frontend)

**ä½ç½®**: `frontend/`

**æŠ€æœ¯æ ˆ**:
- React 19 + TypeScript
- Vite (Rolldown)
- Zustand (çŠ¶æ€ç®¡ç†)
- React Router (è·¯ç”±)
- Tailwind CSS (æ ·å¼)

**æ¶æ„æ¨¡å¼**:
- **Presenter æ¨¡å¼**: ä¸šåŠ¡é€»è¾‘å°è£…åœ¨ Managers ä¸­
- **Provider æ¨¡å¼**: é€šè¿‡ ServiceFactory è·å–æœåŠ¡æä¾›è€…
- **Store æ¨¡å¼**: ä½¿ç”¨ Zustand ç®¡ç†å…¨å±€çŠ¶æ€

**ä¸»è¦æ¨¡å—**:
```
frontend/src/gemini-deploy/
â”œâ”€â”€ components/      # UI ç»„ä»¶
â”œâ”€â”€ pages/          # é¡µé¢ç»„ä»¶
â”œâ”€â”€ managers/       # ä¸šåŠ¡é€»è¾‘ç®¡ç†å™¨
â”œâ”€â”€ services/       # API æœåŠ¡å±‚
â”œâ”€â”€ stores/         # Zustand çŠ¶æ€å­˜å‚¨
â””â”€â”€ types/          # TypeScript ç±»å‹å®šä¹‰
```

### 2. API ç½‘å…³å±‚ (API Worker)

**ä½ç½®**: `workers/api/`

**æŠ€æœ¯æ ˆ**:
- Cloudflare Workers
- TypeScript
- Cloudflare D1 (æ•°æ®åº“)

**èŒè´£**:
- ç”¨æˆ·è®¤è¯å’Œæˆæƒ
- é¡¹ç›®æ•°æ® CRUD
- éƒ¨ç½²è¯·æ±‚ä»£ç†
- ä¼šè¯ç®¡ç†

**æ¶æ„æ¨¡å¼**:
- **MVC æ¨¡å¼**: Controller â†’ Service â†’ Repository
- **è·¯ç”±æ¨¡å¼**: é›†ä¸­å¼è·¯ç”±è¡¨ (`routes.ts`)

**ä¸»è¦æ¨¡å—**:
```
workers/api/src/
â”œâ”€â”€ controllers/    # æ§åˆ¶å™¨ï¼ˆå¤„ç† HTTP è¯·æ±‚ï¼‰
â”œâ”€â”€ services/       # ä¸šåŠ¡é€»è¾‘æœåŠ¡
â”œâ”€â”€ repositories/   # æ•°æ®è®¿é—®å±‚
â”œâ”€â”€ utils/          # å·¥å…·å‡½æ•°
â””â”€â”€ types/          # ç±»å‹å®šä¹‰
```

### 3. éƒ¨ç½²æœåŠ¡å±‚ (Node Service)

**ä½ç½®**: `server/`

**æŠ€æœ¯æ ˆ**:
- Node.js + Express
- TypeScript
- Docker

**èŒè´£**:
- ä»£ç ä»“åº“å…‹éš†
- ä¾èµ–å®‰è£…
- é¡¹ç›®æ„å»º
- éƒ¨ç½²åˆ°ç›®æ ‡å¹³å°ï¼ˆR2/Pagesï¼‰
- SSE æ—¥å¿—æµ

**æ¶æ„æ¨¡å¼**:
- **æ¨¡å—åŒ–æ¶æ„**: æŒ‰åŠŸèƒ½åˆ’åˆ†æ¨¡å—
- **Provider æ¨¡å¼**: å¯æ’æ‹”çš„éƒ¨ç½²æä¾›è€…

**ä¸»è¦æ¨¡å—**:
```
server/src/
â”œâ”€â”€ modules/         # ä¸šåŠ¡æ¨¡å—
â”‚   â”œâ”€â”€ deployment/ # éƒ¨ç½²æ¨¡å—
â”‚   â”œâ”€â”€ projects/   # é¡¹ç›®æ¨¡å—
â”‚   â””â”€â”€ ...
â”œâ”€â”€ routes/         # è·¯ç”±å®šä¹‰
â””â”€â”€ common/         # é€šç”¨å·¥å…·
```

### 4. å­˜å‚¨ç½‘å…³å±‚ (R2 Gateway)

**ä½ç½®**: `workers/r2-gateway/`

**èŒè´£**:
- ä» R2 è¯»å–æ„å»ºäº§ç‰©
- æ ¹æ®å­åŸŸåè·¯ç”±åˆ°å¯¹åº”åº”ç”¨
- æä¾›é™æ€èµ„æºæœåŠ¡

## æŠ€æœ¯æ ˆ

### å‰ç«¯æŠ€æœ¯

| æŠ€æœ¯ | ç”¨é€” | ç‰ˆæœ¬ |
|------|------|------|
| React | UI æ¡†æ¶ | 19.2 |
| TypeScript | ç±»å‹ç³»ç»Ÿ | 5.9 |
| Vite | æ„å»ºå·¥å…· | 7.2 (Rolldown) |
| Zustand | çŠ¶æ€ç®¡ç† | 5.0 |
| React Router | è·¯ç”± | 6.30 |
| Tailwind CSS | æ ·å¼ | 3.x |
| i18next | å›½é™…åŒ– | 25.7 |

### åç«¯æŠ€æœ¯

| æŠ€æœ¯ | ç”¨é€” | ç‰ˆæœ¬ |
|------|------|------|
| Node.js | è¿è¡Œæ—¶ | 18+ |
| Express | Web æ¡†æ¶ | - |
| TypeScript | ç±»å‹ç³»ç»Ÿ | 5.9 |
| Cloudflare Workers | è¾¹ç¼˜è®¡ç®— | - |
| Cloudflare D1 | æ•°æ®åº“ | - |
| Cloudflare R2 | å¯¹è±¡å­˜å‚¨ | - |

### åŸºç¡€è®¾æ–½

| æœåŠ¡ | ç”¨é€” |
|------|------|
| Cloudflare Pages | å‰ç«¯æ‰˜ç®¡ |
| Cloudflare Workers | API ç½‘å…³ |
| Cloudflare D1 | æ•°æ®åº“ |
| Cloudflare R2 | å¯¹è±¡å­˜å‚¨ |
| Docker | å®¹å™¨åŒ– |
| GitHub Actions | CI/CD |

## æ•°æ®æµ

### ç”¨æˆ·ç™»å½•æµç¨‹

```
1. ç”¨æˆ·ç‚¹å‡»ç™»å½•
   â†“
2. å‰ç«¯è°ƒç”¨ /api/v1/auth/email/login
   â†“
3. API Worker éªŒè¯å‡­è¯
   â†“
4. åˆ›å»º Sessionï¼Œè¿”å› Cookie
   â†“
5. å‰ç«¯å­˜å‚¨ç”¨æˆ·çŠ¶æ€
```

### é¡¹ç›®éƒ¨ç½²æµç¨‹

```
1. ç”¨æˆ·åœ¨ Dashboard åˆ›å»ºé¡¹ç›®
   â†“
2. å‰ç«¯è°ƒç”¨ POST /api/v1/projects
   â†“
3. API Worker ä¿å­˜åˆ° D1
   â†“
4. å‰ç«¯è°ƒç”¨ POST /api/v1/deploy
   â†“
5. API Worker ä»£ç†åˆ° Node æœåŠ¡
   â†“
6. Node æœåŠ¡æ‰§è¡Œéƒ¨ç½²ï¼š
   - git clone
   - npm install
   - npm run build
   - ä¸Šä¼ åˆ° R2
   â†“
7. é€šè¿‡ SSE æ¨é€æ—¥å¿—
   â†“
8. éƒ¨ç½²å®Œæˆï¼Œè¿”å›è®¿é—® URL
```

### åº”ç”¨è®¿é—®æµç¨‹

```
1. ç”¨æˆ·è®¿é—® <slug>.gemigo.app
   â†“
2. DNS è§£æåˆ° R2 Gateway Worker
   â†“
3. Worker ä» R2 è¯»å–å¯¹åº”åº”ç”¨
   â†“
4. è¿”å›é™æ€èµ„æº
```

## æ ¸å¿ƒæ¨¡å—

### å‰ç«¯æ¨¡å—

#### Presenter æ¨¡å¼

`Presenter` æ˜¯å‰ç«¯çš„æ ¸å¿ƒåè°ƒè€…ï¼Œå°è£…äº†æ‰€æœ‰ä¸šåŠ¡é€»è¾‘ï¼š

```typescript
class Presenter {
  ui: UIManager          // UI çŠ¶æ€ç®¡ç†
  project: ProjectManager    // é¡¹ç›®ç®¡ç†
  deployment: DeploymentManager  // éƒ¨ç½²ç®¡ç†
  auth: AuthManager      // è®¤è¯ç®¡ç†
  analytics: AnalyticsManager  // æ•°æ®åˆ†æ
  reaction: ReactionManager  // äº’åŠ¨ç®¡ç†ï¼ˆç‚¹èµã€æ”¶è—ï¼‰
}
```

#### Service Factory

é€šè¿‡ `ServiceFactory` è·å–æœåŠ¡æä¾›è€…ï¼Œæ”¯æŒ Mock å’ŒçœŸå®å®ç°åˆ‡æ¢ï¼š

```typescript
// å¼€å‘ç¯å¢ƒå¯ä»¥ä½¿ç”¨ Mock Provider
// ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ HTTP Provider
const provider = ServiceFactory.getProjectProvider();
```

### API Worker æ¨¡å—

#### è·¯ç”±ç³»ç»Ÿ

é›†ä¸­å¼è·¯ç”±è¡¨ (`routes.ts`)ï¼š

```typescript
router.add({
  path: '/api/v1/projects',
  method: 'GET',
  handler: projectsController.listProjects,
});
```

#### é”™è¯¯å¤„ç†

ç»Ÿä¸€çš„é”™è¯¯å¤„ç†æœºåˆ¶ï¼š

```typescript
try {
  // ä¸šåŠ¡é€»è¾‘
} catch (error) {
  if (error instanceof AppError) {
    return handleError(error);
  }
  throw error;
}
```

### Node æœåŠ¡æ¨¡å—

#### éƒ¨ç½²æä¾›è€…

å¯æ’æ‹”çš„éƒ¨ç½²æä¾›è€…ï¼š

```typescript
interface DeploymentProvider {
  deploy(project: Project): Promise<DeploymentResult>;
}

// å®ç°ï¼š
// - LocalProvider (æœ¬åœ°éƒ¨ç½²)
// - CloudflarePagesProvider (Pages éƒ¨ç½²)
// - R2Provider (R2 éƒ¨ç½²)
```

## éƒ¨ç½²æ¶æ„

### å¼€å‘ç¯å¢ƒ

```
æœ¬åœ°å¼€å‘
â”œâ”€â”€ Vite Dev Server (å‰ç«¯)
â”œâ”€â”€ Express Server (åç«¯)
â””â”€â”€ Wrangler Dev (Workers)
```

### ç”Ÿäº§ç¯å¢ƒ

```
ç”Ÿäº§éƒ¨ç½²
â”œâ”€â”€ Cloudflare Pages (å‰ç«¯)
â”œâ”€â”€ Cloudflare Workers (API)
â”œâ”€â”€ Docker Container (Node æœåŠ¡)
â””â”€â”€ Cloudflare R2 (å­˜å‚¨)
```

### CI/CD æµç¨‹

```
GitHub Push
  â†“
GitHub Actions
  â”œâ”€â”€ æ„å»ºå‰ç«¯
  â”œâ”€â”€ æ„å»ºåç«¯ Docker é•œåƒ
  â”œâ”€â”€ éƒ¨ç½²åˆ° Cloudflare Pages
  â”œâ”€â”€ éƒ¨ç½² Workers
  â””â”€â”€ éƒ¨ç½² Node æœåŠ¡åˆ°æœåŠ¡å™¨
```

## å®‰å…¨è€ƒè™‘

### è®¤è¯ä¸æˆæƒ

- Session-based è®¤è¯
- OAuth 2.0 (Google, GitHub)
- å¯†ç å“ˆå¸Œ (SHA-256 + Salt)

### æ•°æ®å®‰å…¨

- æ•æ„Ÿä¿¡æ¯å­˜å‚¨åœ¨ç¯å¢ƒå˜é‡
- API Token åŠ å¯†ä¼ è¾“
- CORS é…ç½®

### éƒ¨ç½²å®‰å…¨

- Docker å®¹å™¨éš”ç¦»
- æœ€å°æƒé™åŸåˆ™
- å®šæœŸå®‰å…¨æ›´æ–°

## æ‰©å±•æ€§

### æ°´å¹³æ‰©å±•

- Workers è‡ªåŠ¨æ‰©å±•
- R2 å­˜å‚¨æ— é™æ‰©å±•
- Node æœåŠ¡å¯å¤šå®ä¾‹éƒ¨ç½²

### åŠŸèƒ½æ‰©å±•

- æ’ä»¶åŒ–çš„éƒ¨ç½²æä¾›è€…
- å¯é…ç½®çš„ AI æœåŠ¡
- æ¨¡å—åŒ–çš„ä»£ç ç»“æ„

## æ€§èƒ½ä¼˜åŒ–

### å‰ç«¯ä¼˜åŒ–

- ä»£ç åˆ†å‰²
- æ‡’åŠ è½½è·¯ç”±
- å›¾ç‰‡ä¼˜åŒ–

### åç«¯ä¼˜åŒ–

- Workers è¾¹ç¼˜è®¡ç®—ï¼ˆä½å»¶è¿Ÿï¼‰
- R2 CDN åŠ é€Ÿ
- æ„å»ºç¼“å­˜

## ç›‘æ§ä¸æ—¥å¿—

### æ—¥å¿—

- Cloudflare Workers æ—¥å¿—
- Node æœåŠ¡æ—¥å¿—
- éƒ¨ç½²æ—¥å¿—ï¼ˆSSEï¼‰

### ç›‘æ§

- Cloudflare Analytics
- é”™è¯¯è¿½è¸ª
- æ€§èƒ½æŒ‡æ ‡

---

**æ›´å¤šè¯¦ç»†ä¿¡æ¯è¯·å‚è€ƒå„æ¨¡å—çš„ä¸“é—¨æ–‡æ¡£ã€‚**

